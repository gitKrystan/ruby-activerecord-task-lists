<div class="row row-horizon">
  <!-- Create a well for each List -->
  <% if @lists.any? %>
    <% @lists.each() do |list| %>
    <div class="col-xs-3 well">
      <h4><%= list.name() %></h4>

      <!-- List each task with form to move or mark complete -->
      <% if @done_task_visibility == "show" %>
        <% list_tasks = list.tasks() %>
      <% else %>
        <% list_tasks = list.tasks.where(done: false) %>
      <% end %>

      <% list_tasks.each() do |task| %>
        <div class="panel">
          <div class="panel-body">
            <form action="/tasks" method="post">
              <input hidden name="task_id" value="<%= task.id() %>">
              <input hidden name="_method" value="patch">

              <div class="form-inline">
                <label for="done"><%= task.description() %></label>
                <% if task.done() %>
                  <button id="finish-<%= task.id() %>" type="submit" class="btn btn-danger btn-xs pull-right" name="done" value="not_done">Mark as Not Done</button>
                <% else %>
                  <button id="finish-<%= task.id() %>" type="submit" class="btn btn-danger btn-xs pull-right" name="done" value="done">Mark as Done</button>
                <% end %>
              </div>

              <div class="input-group">
                <select class="form-control" name="list_id">
                  <option>Move to...</option>
                  <% @lists.each() do |list| %>
                    <option value="<%= list.id() %>"><%= list.name() %></option>
                  <% end %>
                </select>
                <span class="input-group-btn">
                  <button class="btn btn-default" type="submit" name="move" value="clicked">Go</button>
                </span>
              </div>
            </form>
          </div>
        </div>
      <% end %>

      <!-- Form for new tasks -->
      <form action="/tasks" method="post">
        <div class="form-group" >
          <textarea id="task-description-for-<%= list.id() %>" class="form-control" rows="3" name="description" placeholder="Add a task..."></textarea>
        </div>
        <div class="form-group" >
          <button id="save-task-to-<%= list.id() %>" type="submit" class="btn btn-success" name="list_id" value="<%= list.id() %>">Save</button>
        </div>
      </form>
    </div>
    <% end %>
  <% end %>

  <!-- Form for new lists -->
  <div class="col-xs-3 well">
    <form action="/lists" method="post">
      <div class="form-group" >
        <input type="text" class="form-control" name="name" placeholder="Add a list...">
      </div>
      <div class="form-group" >
        <button id="save-new-list" type="submit" class="btn btn-success">Save</button>
      </div>
    </form>
  </div>
</div>

<form action="/">
  <% if @done_task_visibility == "show" %>
    <button type="submit" class="btn btn-default" name="done_task" value="hide">Hide completed tasks</button>
  <% else %>
    <button type="submit" class="btn btn-default" name="done_task" value="show">Show completed tasks</button>
  <% end %>
</form>
